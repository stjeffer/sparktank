<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Frontier — Live Differences / Initiatives (Light)</title>
<style>
  :root{
    --bg:#f7fafc;
    --card:#ffffff;
    --ink:#1f2937;           /* slate-800 */
    --muted:#556581;         /* slate-ish */
    --primary:#3b82f6;       /* blue-500 */
    --primary-600:#2563eb;
    --accent:#10b981;        /* emerald */
    --warn:#f59e0b;          /* amber */
    --danger:#ef4444;        /* red */
    --border:#e5e7eb;        /* gray-200 */
    --shadow:0 10px 24px rgba(31,41,55,.12);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink); background:
      radial-gradient(1100px 480px at 80% -10%, #e8f1ff 0%, #f5fbff 40%, var(--bg) 70%);
    font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  header{padding:18px 18px 8px; display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap}
  h1{margin:.2rem 0 .3rem; font-size:26px}
  .sub{color:var(--muted); max-width:960px}
  .nav{display:flex; gap:8px; flex-wrap:wrap}
  .tab{background:#fff; border:1px solid #d8dee8; color:#1f2937; padding:8px 12px; border-radius:10px; cursor:pointer}
  .tab.active{border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.18) inset}
  .wrap{padding:10px 18px 24px; display:grid; gap:16px}
  .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
  .panel header{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
  .panel main{padding:14px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .btn{background:#eff6ff; color:#0f3a8a; border:1px solid #cfe0ff; padding:10px 14px; border-radius:12px; cursor:pointer}
  .btn:hover{background:#e6f0ff}
  .btn-primary{background:linear-gradient(180deg,#60a5fa,#3b82f6); color:#fff; border:1px solid #3b82f6}
  .btn-ghost{background:#fff; border:1px solid #d8dee8; color:#334155}
  .btn-warn{background:#fff7ed; color:#9a3412; border:1px solid #fed7aa}
  .btn-danger{background:#fee2e2; color:#991b1b; border:1px solid #fecaca}
  .btn-small{padding:6px 10px; border-radius:10px; font-size:14px}
  input, select, textarea{
    background:#fff; border:1px solid #d8dee8; color:#1f2937; border-radius:12px; padding:10px 12px; width:100%
  }
  input:focus, select:focus, textarea:focus{outline:none; border-color:#c4d5ff; box-shadow:0 0 0 3px rgba(59,130,246,.15)}
  label{display:block; font-size:13px; color:#42506b; margin:8px 0 6px}
  .grid{display:grid; gap:12px}
  .cols-2{grid-template-columns:1fr 1fr}
  .cols-3{grid-template-columns:repeat(3,1fr)}
  .hint{font-size:12px; color:#6b7280}
  .tag{display:inline-flex; align-items:center; gap:6px; background:#f1f5f9; color:#334155; border:1px solid #e2e8f0; border-radius:999px; padding:4px 10px; font-size:12px}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7e0ee; font-size:12px; background:#f8fafc; color:#334155}
  .badge{background:#ecfeff; color:#155e75; border:1px solid #bae6fd; padding:2px 8px; border-radius:999px; font-size:12px}
  .cards{display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(310px,1fr))}
  .card{background:#fff; border:1px solid #e7ecf4; border-radius:14px; padding:12px 12px 10px; position:relative; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .meta{color:#556581; font-size:13px}
  .kpi{font-size:13px; color:#334155}
  .vote{display:flex; gap:8px; align-items:center}
  .dot{width:12px; height:12px; border-radius:999px; background:#3b82f6}
  .status{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #e2e8f0}
  .s-open{background:#f0f9ff; color:#075985; border-color:#bae6fd}
  .s-locked{background:#fff7ed; color:#9a3412; border-color:#fed7aa}
  .timer{font-variant-numeric:tabular-nums; font-weight:700; font-size:28px; letter-spacing:.5px}
  .filter{display:flex; gap:8px; flex-wrap:wrap}
  .chip{border:1px solid #d7e0ee; border-radius:999px; padding:6px 10px; background:#fff; color:#334155; cursor:pointer; font-size:13px}
  .chip.active{border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.18) inset}
  .empty{padding:16px; border:2px dashed #d8dee8; border-radius:12px; color:#6b7280; background:#fbfdff}
  .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
</style>
</head>
<body>

<header>
  <div>
    <h1>Live Differences / Initiatives</h1>
    <div class="sub">Facilitator sees real-time submissions. A <strong>25-minute timer</strong> runs the capture window. When time’s up, lock the board and open participant voting (3 votes each).</div>
  </div>
  <nav class="nav" id="nav"></nav>
</header>

<section class="wrap">
  <!-- FACILITATOR SCREEN -->
  <div id="screen-fac" class="panel" style="display:none">
    <header>
      <strong>Facilitator — Capture Window</strong>
      <div class="right">
        <span id="lockState" class="status s-open">OPEN</span>
        <span class="timer" id="timer">25:00</span>
        <button class="btn btn-ghost btn-small" id="startTimer">Start</button>
        <button class="btn btn-ghost btn-small" id="pauseTimer">Pause</button>
        <button class="btn btn-ghost btn-small" id="resetTimer">Reset</button>
        <button class="btn btn-warn btn-small" id="lockNow">Lock Now</button>
        <button class="btn btn-ghost btn-small" id="exportJSON">Export JSON</button>
      </div>
    </header>
    <main>
      <div class="row" style="justify-content:space-between">
        <div class="filter" id="pillarFilter">
          <span class="chip active" data-p="all">All</span>
          <span class="chip" data-p="employee">Employee</span>
          <span class="chip" data-p="customer">Customer</span>
          <span class="chip" data-p="process">Process</span>
          <span class="chip" data-p="innovation">Innovation</span>
        </div>
        <div class="row">
          <span class="tag">Teams connected: <span id="teamCount">0</span></span>
          <span class="tag">Initiatives: <span id="initCount">0</span></span>
        </div>
      </div>

      <div id="stream" class="cards" style="margin-top:10px"></div>

      <div class="hint" style="margin-top:10px">
        Tip: Keep the facilitator screen on a big display. Teams submit via “Team Input” tab (open in other tabs/devices).
      </div>
    </main>
  </div>

  <!-- TEAM INPUT / KIOSK -->
  <div id="screen-team" class="panel" style="display:none">
    <header><strong>Team Input — Submit Differences / Initiatives</strong><span class="hint">Submissions appear instantly on the facilitator screen if the board is OPEN.</span></header>
    <main>
      <div class="grid cols-2">
        <div>
          <label for="tTeam">Team name *</label>
          <input id="tTeam" type="text" placeholder="Team Nova"/>
        </div>
        <div>
          <label for="tPillar">Pillar *</label>
          <select id="tPillar">
            <option value="employee">Employee</option>
            <option value="customer">Customer</option>
            <option value="process">Process</option>
            <option value="innovation">Innovation</option>
          </select>
        </div>
      </div>
      <div class="grid">
        <div>
          <label for="tTitle">What’s different / initiative *</label>
          <input id="tTitle" type="text" placeholder="Every employee uses Copilot to automate routine tasks"/>
        </div>
      </div>
      <div class="grid cols-3">
        <div>
          <label for="tKPI">KPI</label>
          <input id="tKPI" type="text" placeholder="Hrs saved / FTE"/>
        </div>
        <div>
          <label for="tTarget">Target</label>
          <input id="tTarget" type="text" placeholder="2 hrs/wk"/>
        </div>
        <div>
          <label for="tHorizon">Horizon</label>
          <select id="tHorizon">
            <option value="0-3">0–3 months</option>
            <option value="3-6">3–6 months</option>
            <option value="6-12">6–12 months</option>
          </select>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn btn-primary" id="submitInit">+ Submit</button>
        <button class="btn btn-ghost" id="seedBtn">Seed Examples</button>
        <span class="hint">Each browser remembers its team name for quick re-entry.</span>
      </div>
    </main>
  </div>

  <!-- PARTICIPANT VOTING -->
  <div id="screen-vote" class="panel" style="display:none">
    <header>
      <strong>Participant Voting — Pick Your Favorites</strong>
      <div class="row">
        <span id="votingState" class="status s-open">WAITING</span>
        <span class="tag">Your votes left: <strong id="votesLeft">3</strong></span>
        <button class="btn btn-ghost btn-small" id="resetMyVotes">Reset my votes</button>
      </div>
    </header>
    <main>
      <div id="ballot" class="cards"></div>
      <div class="hint" style="margin-top:10px">You have 3 total votes. Click “+1 vote” on any initiative you support.</div>
    </main>
  </div>
</section>

<script>
  /* ------------------------ Real-time channel ------------------------ */
  const chan = new BroadcastChannel('frontier-room');
  function publish(type, payload){ chan.postMessage({type, payload}); }

  /* ------------------------ State ------------------------ */
  let locked = false;
  let initiatives = []; // {id, team, pillar, title, kpi, target, horizon, votes}
  let teamsConnected = new Set();
  let filter = 'all';
  let myVotes = Number(localStorage.getItem('votes.left')||3);

  /* ------------------------ Utilities ------------------------ */
  const q = sel => document.querySelector(sel);
  const qa = sel => Array.from(document.querySelectorAll(sel));
  const uid = () => Math.random().toString(36).slice(2,10);
  function esc(s){ return String(s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  /* ------------------------ Navigation ------------------------ */
  const screens = [
    {id:'screen-fac', label:'Facilitator'},
    {id:'screen-team', label:'Team Input'},
    {id:'screen-vote', label:'Participant Voting'},
  ];
  let current = 0;
  function renderNav(){
    const nav = q('#nav'); nav.innerHTML='';
    screens.forEach((s,i)=>{
      const b = document.createElement('button');
      b.className = 'tab'+(i===current?' active':'');
      b.textContent = s.label;
      b.addEventListener('click', ()=> show(i));
      nav.appendChild(b);
    });
  }
  function show(i){
    current = i; renderNav();
    screens.forEach((s,idx)=> q('#'+s.id).style.display = idx===i?'block':'none');
    if(i===0) renderFac();
    if(i===1) renderTeam();
    if(i===2) renderVote();
  }

  /* ------------------------ Seed believable data ------------------------ */
  function seedData(){
    const demo = [
      mk('Team Nova','employee','Every employee uses Copilot to automate routine tasks','Hrs saved / FTE','2 hrs/wk','0-3',3),
      mk('Team Atlas','customer','AI Sales Companion suggests next-best-offer','Win rate','+10%','3-6',2),
      mk('Team Quasar','process','Workflow orchestrator across CRM/ERP','Cycle time','< 48h','6-12',1),
      mk('Team Meridian','customer','Proactive service: resolve before call','Inbound volume','-25%','3-6',0),
      mk('Team Horizon','innovation','Monthly AI prototypes demo day','Prototypes/yr','12','6-12',0),
      mk('Team Vertex','employee','Meeting recaps + next steps auto-generated','Adoption','>70%','0-3',1),
    ];
    demo.forEach(d=> upsertInit(d));
  }
  function mk(team,pillar,title,kpi,target,horizon,seedVotes){
    return { id:uid(), team, pillar, title, kpi, target, horizon, votes:seedVotes||0 };
  }

  /* ------------------------ FACILITATOR ------------------------ */
  const stream = q('#stream');
  function renderFac(){
    // header stats
    q('#teamCount').textContent = teamsConnected.size;
    q('#initCount').textContent = initiatives.length;
    q('#lockState').textContent = locked ? 'LOCKED' : 'OPEN';
    q('#lockState').className = 'status ' + (locked?'s-locked':'s-open');

    // filter chips
    qa('#pillarFilter .chip').forEach(ch => {
      ch.classList.toggle('active', ch.dataset.p===filter || (filter==='all' && ch.dataset.p==='all'));
    });

    // stream
    stream.innerHTML='';
    const data = initiatives
      .filter(i => filter==='all' ? true : i.pillar===filter)
      .sort((a,b)=> b.votes - a.votes);
    if(!data.length){
      stream.innerHTML = `<div class="empty">No initiatives yet. Ask teams to submit from the “Team Input” tab (or another device).</div>`;
      return;
    }
    data.forEach(i=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="row" style="justify-content:space-between">
          <div><strong>${esc(i.title)}</strong></div>
          <div class="row">
            <span class="pill">${cap(i.pillar)}</span>
            <span class="badge">${esc(i.team)}</span>
            <span class="pill">${esc(i.horizon)}</span>
          </div>
        </div>
        <div class="kpi">KPI: <strong>${esc(i.kpi||'—')}</strong> &nbsp; Target: <strong>${esc(i.target||'—')}</strong></div>
        <div class="row" style="margin-top:6px">
          <div class="vote"><div class="dot"></div> Votes: <strong>${i.votes||0}</strong></div>
          ${locked ? '<span class="tag">Locked</span>' : '<span class="tag">Live</span>'}
        </div>
      `;
      stream.appendChild(card);
    });
  }

  // Filter handlers
  qa('#pillarFilter .chip').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      filter = ch.dataset.p;
      renderFac();
    });
  });

  // Export
  q('#exportJSON').addEventListener('click', ()=>{
    const payload = { generatedAt:new Date().toISOString(), locked, initiatives };
    download('initiatives.json', JSON.stringify(payload,null,2));
  });
  function download(filename, text){
    const blob = new Blob([text], {type:'application/json;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href);
  }

  // Lock Now
  q('#lockNow').addEventListener('click', ()=> lockBoard(true));

  /* ------------------------ TEAM INPUT ------------------------ */
  function renderTeam(){
    const name = localStorage.getItem('team.name') || '';
    if(name) q('#tTeam').value = name;
    // disable when locked
    qa('#screen-team input, #screen-team select, #screen-team button').forEach(el=>{
      if(el.id!=='seedBtn') el.disabled = locked;
    });
  }

  q('#submitInit').addEventListener('click', ()=>{
    if(locked) return alert('Board is locked. Submissions closed.');
    const team = q('#tTeam').value.trim();
    const pillar = q('#tPillar').value;
    const title = q('#tTitle').value.trim();
    if(!team || !title){ return alert('Please enter team name and initiative.'); }
    const kpi = q('#tKPI').value.trim();
    const target = q('#tTarget').value.trim();
    const horizon = q('#tHorizon').value;
    localStorage.setItem('team.name', team);

    const item = { id:uid(), team, pillar, title, kpi, target, horizon, votes:0 };
    publish('init:add', item);
    upsertInit(item);
    // quick clear title
    q('#tTitle').value='';
    q('#tTitle').focus();
  });

  q('#seedBtn').addEventListener('click', seedData);

  /* ------------------------ PARTICIPANT VOTING ------------------------ */
  function renderVote(){
    q('#votingState').textContent = locked ? 'VOTING OPEN' : 'WAITING';
    q('#votingState').className = 'status ' + (locked ? 's-open' : 's-locked'); // visually green when open
    q('#votesLeft').textContent = myVotes;
    const cont = q('#ballot'); cont.innerHTML='';
    if(!locked){
      cont.innerHTML = `<div class="empty">Voting opens when the facilitator locks the board.</div>`;
      return;
    }
    const items = [...initiatives].sort((a,b)=> b.votes - a.votes);
    items.forEach(i=>{
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `
        <div class="row" style="justify-content:space-between">
          <div><strong>${esc(i.title)}</strong></div>
          <div class="row">
            <span class="pill">${cap(i.pillar)}</span>
            <span class="badge">${esc(i.team)}</span>
            <span class="pill">${esc(i.horizon)}</span>
          </div>
        </div>
        <div class="kpi">KPI: <strong>${esc(i.kpi||'—')}</strong> &nbsp; Target: <strong>${esc(i.target||'—')}</strong></div>
        <div class="row" style="margin-top:6px">
          <div class="vote"><div class="dot"></div>
            <button class="btn btn-ghost btn-small" data-id="${i.id}">+1 vote</button>
            <span>Votes: <strong id="v_${i.id}">${i.votes||0}</strong></span>
          </div>
        </div>
      `;
      cont.appendChild(card);
    });
    // vote handlers
    cont.querySelectorAll('button[data-id]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        if(!locked){ return; }
        if(myVotes<=0){ alert('You have used your 3 votes.'); return; }
        const id = btn.dataset.id;
        myVotes -= 1;
        localStorage.setItem('votes.left', String(myVotes));
        q('#votesLeft').textContent = myVotes;
        publish('vote:add', {id});
        addVoteLocal(id);
      });
    });
  }
  q('#resetMyVotes').addEventListener('click', ()=>{
    myVotes = 3;
    localStorage.setItem('votes.left','3');
    q('#votesLeft').textContent = myVotes;
  });

  function addVoteLocal(id){
    const it = initiatives.find(x=>x.id===id);
    if(!it) return;
    it.votes = (it.votes||0)+1;
    const el = q(`#v_${id}`); if(el) el.textContent = it.votes;
    // live refresh on facilitator
    if(current===0) renderFac();
  }

  /* ------------------------ Data helpers ------------------------ */
  function upsertInit(item){
    const i = initiatives.findIndex(x=>x.id===item.id);
    if(i>-1) initiatives[i] = {...initiatives[i], ...item};
    else initiatives.push(item);
    renderFac();
    if(locked) renderVote();
  }

  function cap(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : s; }

  /* ------------------------ Timer (25:00) ------------------------ */
  let remaining = 25*60; // seconds
  let tHandle = null;

  function fmt(sec){
    const m = Math.floor(sec/60), s = sec%60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  function tick(){
    if(remaining<=0){
      clearInterval(tHandle); tHandle=null;
      q('#timer').textContent = '00:00';
      lockBoard(false); // auto-lock
      return;
    }
    remaining -= 1;
    q('#timer').textContent = fmt(remaining);
  }

  q('#startTimer').addEventListener('click', ()=>{
    if(locked) return;
    if(tHandle) return;
    tHandle = setInterval(tick, 1000);
  });
  q('#pauseTimer').addEventListener('click', ()=>{
    if(tHandle){ clearInterval(tHandle); tHandle=null; }
  });
  q('#resetTimer').addEventListener('click', ()=>{
    if(tHandle){ clearInterval(tHandle); tHandle=null; }
    remaining = 25*60;
    q('#timer').textContent = fmt(remaining);
  });

  function lockBoard(manual){
    if(locked) return;
    locked = true;
    publish('state:lock', {at:new Date().toISOString(), manual});
    // freeze inputs on team screen, open voting
    renderFac();
    renderTeam();
    renderVote();
  }

  /* ------------------------ Channel listeners ------------------------ */
  chan.onmessage = (e)=>{
    const {type, payload} = e.data||{};
    switch(type){
      case 'hello':
        teamsConnected.add(payload?.team||'Unknown');
        if(current===0) renderFac();
        break;
      case 'init:add':
        if(locked) return;
        upsertInit(payload);
        break;
      case 'vote:add':
        addVoteLocal(payload.id);
        break;
      case 'state:lock':
        locked = true;
        renderFac(); renderTeam(); renderVote();
        break;
      case 'state:seed':
        payload?.forEach(p=> upsertInit(p));
        break;
    }
  };

  // announce presence (each tab)
  publish('hello', {team: 'browser-'+uid()});

  /* ------------------------ Init UI ------------------------ */
  function build(){
    renderNav();
    show(0); // default to Facilitator
    // seed a few initiatives so the screen looks alive
    seedData();
    // initial timer text
    q('#timer').textContent = fmt(remaining);
    // team count (roughly estimate based on hello events)
    setInterval(()=>{
      q('#teamCount').textContent = teamsConnected.size;
    }, 1000);
  }
  build();
</script>
</body>
</html>

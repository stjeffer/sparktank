<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Frontier — Vision Builder (Facilitator + Plan & Impact)</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --ink:#1f2937; --muted:#556581;
    --primary:#3b82f6; --accent:#10b981; --warn:#f59e0b; --violet:#8b5cf6;
    --border:#e5e7eb; --shadow:0 10px 24px rgba(31,41,55,.12); --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1100px 480px at 80% -10%, #e8f1ff 0%, #f5fbff 40%, var(--bg) 70%);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }
  header{padding:18px 18px 8px; display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap}
  h1{margin:.2rem 0 .3rem; font-size:26px}
  .sub{color:var(--muted); max-width:980px}
  .nav{display:flex; gap:8px; flex-wrap:wrap}
  .tab{background:#fff; border:1px solid #d8dee8; color:#1f2937; padding:8px 12px; border-radius:10px; cursor:pointer}
  .tab.active{border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.18) inset}
  .wrap{padding:10px 18px 24px; display:grid; gap:16px}

  .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
  .panel header{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
  .panel main{padding:14px}

  .grid{display:grid; gap:12px}
  .cols-2{grid-template-columns:1fr 1fr}
  .two{display:grid; grid-template-columns: 1fr 360px; gap:16px}
  .list{display:grid; gap:10px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .small{font-size:12px; color:#6b7280}
  .hint{font-size:12px; color:#6b7280}

  .status{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #e2e8f0}
  .s-open{background:#f0f9ff; color:#075985; border-color:#bae6fd}
  .s-locked{background:#fff7ed; color:#9a3412; border-color:#fed7aa}

  .card{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:10px 12px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .btn{background:#eff6ff; color:#0f3a8a; border:1px solid #cfe0ff; padding:10px 14px; border-radius:12px; cursor:pointer}
  .btn:hover{background:#e6f0ff}
  .btn-ghost{background:#fff; border:1px solid #d8dee8; color:#334155}
  .btn-warn{background:#fff7ed; color:#9a3412; border:1px solid #fed7aa}
  .btn-small{padding:6px 10px; border-radius:10px; font-size:14px}

  .winner{background:#ecfeff; border:1px solid #bae6fd; color:#155e75; padding:10px 12px; border-radius:12px}
  .vote{display:flex; gap:8px; align-items:center}
  .dot{width:12px; height:12px; border-radius:999px; background:#3b82f6}

  /* Plan board */
  .board{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
  .lane{background:#fff; border:2px dashed #d8dee8; border-radius:14px; min-height:200px; padding:10px}
  .lane h3{text-align:center; margin:0 0 8px; color:#1f3a8a}
  .icard{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:8px; margin:8px 0; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7e0ee; font-size:12px; background:#f8fafc; color:#334155}
  .impact{display:flex; gap:6px; flex-wrap:wrap; margin-top:6px}
  .impact .k{background:#eefdf4; color:#065f46; border:1px solid #a7f3d0}
  .impact .p{background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe}
  .impact .c{background:#fff7ed; color:#92400e; border:1px solid #fde68a}
  .impact .r{background:#f5f3ff; color:#5b21b6; border:1px solid #ddd6fe}

  /* Impact spotlight */
  .spot{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .spot .tile{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:10px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .kpi{font-size:13px; color:#334155}
</style>
</head>
<body>

<header>
  <div>
    <h1>Vision Builder — Facilitator View</h1>
    <div class="sub">Live statements, lock & voting — plus a **sequenced initiative plan** with **impact callouts** for the executive take-away.</div>
  </div>
  <nav class="nav" id="nav"></nav>
</header>

<section class="wrap">
  <!-- FACILITATOR: Statements & Voting -->
  <div id="screen-fac" class="panel">
    <header>
      <strong>Live Statements & Voting</strong>
      <div class="row">
        <span id="lockStateFac" class="status s-open">OPEN</span>
        <button class="btn-ghost btn-small" id="seed">Seed statements</button>
        <button class="btn-warn btn-small" id="toggleLock">Lock / Unlock</button>
        <button class="btn-ghost btn-small" id="exportJSON">Export JSON</button>
        <button class="btn-ghost btn-small" id="exportMD">Export Markdown</button>
      </div>
    </header>
    <main class="two">
      <!-- Statements -->
      <div class="panel" style="margin:0">
        <header><strong>Submitted Statements</strong> <span class="small" id="countLbl"></span></header>
        <main>
          <div id="statements" class="list"></div>
        </main>
      </div>

      <!-- Winner -->
      <aside class="panel" style="margin:0">
        <header><strong>Winning Statement</strong></header>
        <main>
          <div id="winnerBox" class="winner small">No winner yet. Lock to open voting; set winner once votes converge.</div>
          <div class="grid" style="margin-top:10px">
            <div>
              <label for="why">Why this matters (exec-ready)</label>
              <textarea id="why" placeholder="Tie vision to revenue, differentiation, risk posture."></textarea>
            </div>
            <div>
              <label for="notes">Facilitator notes</label>
              <textarea id="notes" placeholder="Clarifications / commitments agreed."></textarea>
            </div>
          </div>
        </main>
      </aside>
    </main>
  </div>

  <!-- FACILITATOR: Plan & Impact -->
  <div id="screen-plan" class="panel">
    <header>
      <strong>12-Month Frontier Action Plan & Impact</strong>
      <div class="row">
        <button class="btn-ghost btn-small" id="seedPlan">Seed plan</button>
        <button class="btn-ghost btn-small" id="importPlanBtn">Import plan (JSON)</button>
        <input id="importPlan" type="file" accept=".json" style="display:none"/>
        <button class="btn-ghost btn-small" id="exportPlan">Export plan (JSON)</button>
      </div>
    </header>
    <main>
      <div class="board" id="board">
        <!-- lanes injected -->
      </div>

      <div class="card" style="margin-top:12px">
        <div class="row" style="justify-content:space-between">
          <strong>Impact Spotlight</strong>
          <span class="small">Mock estimates derived from initiative intent and KPI targets</span>
        </div>
        <div class="spot" id="spot">
          <!-- tiles injected -->
        </div>
      </div>
    </main>
  </div>
</section>

<script>
  /* -------------------- Real-time channel (statements) -------------------- */
  const chan = new BroadcastChannel('frontier-vision-live');
  const publish = (type, payload) => chan.postMessage({type, payload});

  /* -------------------- State: vision -------------------- */
  let locked = false;        // voting lock
  let statements = [];       // {id, team, text, themes[], evidence, tone[], votes}
  let winnerId = null;

  /* -------------------- State: plan & impact (mock/demo) -------------------- */
  // initiative: {id, horizon:'0-3'|'3-6'|'6-12', title, pillar, kpi, target, impacts:[{type:'rev'|'prod'|'cx'|'risk', text}]}
  let plan = { '0-3':[], '3-6':[], '6-12':[] };

  /* -------------------- Helpers -------------------- */
  const q = s => document.querySelector(s);
  const qa = s => Array.from(document.querySelectorAll(s));
  const uid = () => Math.random().toString(36).slice(2,10);
  const esc = s => String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  /* -------------------- Render: statements -------------------- */
  function renderFac(){
    q('#lockStateFac').textContent = locked ? 'LOCKED (Voting Open)' : 'OPEN';
    q('#lockStateFac').className = 'status ' + (locked ? 's-locked' : 's-open');
    q('#countLbl').textContent = `${statements.length} statement${statements.length===1?'':'s'}`;

    const wrap = q('#statements'); wrap.innerHTML='';
    if(!statements.length){
      wrap.innerHTML = '<div class="card small">No statements yet.</div>';
    } else {
      statements.forEach(s=>{
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `
          <div class="row" style="justify-content:space-between">
            <div><strong>${esc(s.team)}</strong> <span class="small">(${(s.tone||[]).join(', ')||'—'})</span></div>
            <div class="row">
              <span class="small">Votes: <strong id="votes_${s.id}">${s.votes||0}</strong></span>
              <button class="btn-ghost btn-small" data-action="setWinner" data-id="${s.id}">Set as Winner</button>
            </div>
          </div>
          <div style="margin-top:6px">${esc(s.text)}</div>
          <div class="small" style="margin-top:6px">Themes: ${esc((s.themes||[]).join(' • ')||'—')}</div>
          <div class="small">Evidence: ${esc(s.evidence||'—')}</div>
        `;
        wrap.appendChild(div);
      });
      wrap.querySelectorAll('button[data-action="setWinner"]').forEach(btn=>{
        btn.onclick = ()=>{
          winnerId = btn.dataset.id;
          publish('vision:winner', {id:winnerId});
          renderWinnerBox();
        };
      });
    }
    renderWinnerBox();
  }
  function renderWinnerBox(){
    const box = q('#winnerBox');
    const w = statements.find(x=>x.id===winnerId);
    if(!w){ box.className='winner small'; box.textContent='No winner yet. Lock to open voting; set winner once votes converge.'; return; }
    box.className='winner';
    box.innerHTML = `<div class="small">Winning statement from <strong>${esc(w.team)}</strong></div>
      <div style="margin-top:6px"><strong>${esc(w.text)}</strong></div>
      <div class="small" style="margin-top:6px">Themes: ${esc((w.themes||[]).join(' • ')||'—')}</div>
      <div class="small">Evidence: ${esc(w.evidence||'—')}</div>`;
  }

  /* -------------------- Render: plan board + impact spotlight -------------------- */
  function renderPlan(){
    const board = q('#board'); board.innerHTML='';
    const lanes = [
      {key:'0-3', label:'0–3 months', note:'Quick wins / foundation'},
      {key:'3-6', label:'3–6 months', note:'Scale-ups'},
      {key:'6-12', label:'6–12 months', note:'Transformational'},
    ];
    lanes.forEach(L=>{
      const col = document.createElement('div');
      col.className='lane';
      col.innerHTML = `<h3>${L.label}</h3><div class="small">${L.note}</div>`;
      (plan[L.key]||[]).forEach(it=>{
        const card = document.createElement('div'); card.className='icard';
        card.innerHTML = `
          <div class="row" style="justify-content:space-between">
            <strong>${esc(it.title)}</strong>
            <span class="pill">${esc(cap(it.pillar))}</span>
          </div>
          <div class="small">KPI: <strong>${esc(it.kpi)}</strong> &nbsp; Target: <strong>${esc(it.target)}</strong></div>
          <div class="impact">
            ${it.impacts.map(p=>impactPill(p)).join('')}
          </div>
        `;
        col.appendChild(card);
      });
      board.appendChild(col);
    });

    // Impact spotlight tiles (roll-up)
    const roll = rollupImpact();
    const spot = q('#spot'); spot.innerHTML='';
    const tiles = [
      {label:'Projected revenue uplift (12m)', val: roll.rev || '£—', sub:'Based on sales/CX initiatives', key:'rev'},
      {label:'Productivity hours saved (per week)', val: roll.prod || '—', sub:'Approx. per FTE across pilots', key:'prod'},
      {label:'CX improvement', val: roll.cx || '—', sub:'Inbound reduction / AOV / retention', key:'cx'},
      {label:'Risk posture', val: roll.risk || '—', sub:'Audit/compliance improvements', key:'risk'},
      {label:'Innovation throughput', val: roll.innov || '—', sub:'Prototypes / launches', key:'innov'},
      {label:'Cycle time', val: roll.cycle || '—', sub:'Avg end-to-end cycle target', key:'cycle'},
    ];
    tiles.forEach(t=>{
      const d = document.createElement('div'); d.className='tile';
      d.innerHTML = `<div class="small">${t.label}</div>
        <div style="font-size:22px;font-weight:700;margin:2px 0 4px">${esc(t.val)}</div>
        <div class="kpi">${esc(t.sub)}</div>`;
      spot.appendChild(d);
    });
  }

  function impactPill(p){
    const m = {rev:'k', prod:'p', cx:'c', risk:'r'};
    const cls = m[p.type] || 'k';
    return `<span class="pill ${cls}">${esc(p.text)}</span>`;
  }
  function rollupImpact(){
    // naive roll-up from mock values
    const r = {rev:'£1.8M–£2.4M', prod:'~2 hrs/FTE/wk', cx:'−20–25% inbound', risk:'−30–40% findings', innov:'12 prototypes/yr', cycle:'< 48h'};
    return r;
  }

  /* -------------------- Seed data -------------------- */
  function seedStatements(){
    const seed = [
      {team:'Team Nova', text:'We are an AI-empowered organization where every employee is augmented by Copilot, customer needs are anticipated, and decisions move at the speed of data — turning innovation into a monthly habit with trust by design.', themes:['Empowered workforce','Proactive customer value','Intelligent operations','Trusted & responsible AI'], tone:['Ambitious','People-first'], evidence:'+10% win rate • −25% inbound • <48h cycle • 2 hrs/FTE/wk', votes:2},
      {team:'Team Atlas', text:'In 12 months we operate as a trusted, data-driven enterprise: employees focus on high-value work, customer engagement is proactive, and intelligent operations shrink cycle time from weeks to days.', themes:['Data-driven growth','Intelligent operations'], tone:['Practical','Operational'], evidence:'12 prototypes/yr • <48h cycle', votes:1}
    ].map(s=> ({id:uid(), ...s}));
    statements.push(...seed);
    publish('vision:seed', seed);
    renderFac();
  }

  function seedPlan(){
    plan = {
      '0-3':[
        mkPlan('Employee Copilot pilot (HR & Sales)','employee','Hrs saved / FTE','2 hrs/wk',[
          {type:'prod', text:'+2 hrs/FTE/wk'}, {type:'risk', text:'Guardrails in place'}
        ]),
        mkPlan('AI meeting recaps + next-step assistant','employee','Adoption','>70%',[
          {type:'prod', text:'Fewer meetings, clearer actions'}
        ]),
        mkPlan('Knowledge hub answers in 30s','employee','Time to answer','<30s',[
          {type:'prod', text:'Faster resolution'}
        ]),
      ],
      '3-6':[
        mkPlan('AI Sales Companion (next-best-offer)','customer','Win rate','+10%',[
          {type:'rev', text:'+£1.0M pipeline'}, {type:'cx', text:'Higher AOV'}
        ]),
        mkPlan('Proactive service (resolve before call)','customer','Inbound volume','-25%',[
          {type:'cx', text:'Reduced inbound'}, {type:'rev', text:'Churn ↓ 3 pts'}
        ]),
        mkPlan('Workflow orchestrator (CRM↔ERP)','process','Cycle time','< 48h',[
          {type:'prod', text:'Cycle time ↓'}, {type:'risk', text:'Fewer handoffs'}
        ]),
      ],
      '6-12':[
        mkPlan('AI Product Studio (monthly demos)','innovation','Prototypes/yr','12',[
          {type:'rev', text:'New SKUs'}, {type:'prod', text:'Faster iteration'}
        ]),
        mkPlan('Data monetization pilot','innovation','Data ARR','$600k',[
          {type:'rev', text:'+£600k ARR'}, {type:'risk', text:'Data controls'}
        ]),
        mkPlan('Intelligent ops dashboard','process','Observability','Org-wide',[
          {type:'prod', text:'ROI visibility'}, {type:'risk', text:'Policy audit'}
        ]),
      ]
    };
    renderPlan();
  }
  function mkPlan(title,pillar,kpi,target,impacts){ return {id:uid(), horizon:pickH(kpi), title,pillar,kpi,target, impacts}; }
  function pickH(){ return '0-3'; } // unused (explicit horizons)

  /* -------------------- Exports -------------------- */
  q('#exportJSON').onclick = ()=>{
    const payload = { generatedAt:new Date().toISOString(), locked, winnerId, statements, why:q('#why').value.trim(), notes:q('#notes').value.trim(), plan };
    download('vision-facilitator.json', JSON.stringify(payload,null,2), 'application/json');
  };
  q('#exportMD').onclick = ()=>{
    const w = statements.find(x=>x.id===winnerId);
    const md = `# Shared AI Vision — Workshop Output

**Vision (final):**
> ${w ? w.text : '(winner not set yet)'}

**Supporting themes:** ${w ? (w.themes||[]).join(' • ') : '—'}

**Why this matters:**  
${q('#why').value.trim()||'—'}

**Evidence lines:**  
- ${(w?.evidence||'—').split('•').map(s=>s.trim()).filter(Boolean).join('\n- ')}

---

## Frontier Action Plan (12 months)

### 0–3 months
${(plan['0-3']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}  \n  Impact: ${i.impacts.map(x=>x.text).join(', ')}`).join('\n')}

### 3–6 months
${(plan['3-6']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}  \n  Impact: ${i.impacts.map(x=>x.text).join(', ')}`).join('\n')}

### 6–12 months
${(plan['6-12']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}  \n  Impact: ${i.impacts.map(x=>x.text).join(', ')}`).join('\n')}
`;
    download('vision-summary.md', md, 'text/markdown');
  };
  q('#exportPlan').onclick = ()=>{
    const payload = { generatedAt:new Date().toISOString(), plan };
    download('frontier-plan.json', JSON.stringify(payload,null,2), 'application/json');
  };
  q('#importPlanBtn').onclick = ()=> q('#importPlan').click();
  q('#importPlan').addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return;
    const fr = new FileReader();
    fr.onload = ()=>{
      try{
        const data = JSON.parse(fr.result);
        if(data.plan){ plan = data.plan; } else if(data['0-3']||data['3-6']||data['6-12']) { plan=data; }
        else { alert('File does not contain a plan.'); return; }
        renderPlan();
      }catch(_){ alert('Could not parse plan file.'); }
    };
    fr.readAsText(f);
  });

  function download(filename, text, type){
    const blob = new Blob([text], {type:type||'text/plain;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href);
  }

  /* -------------------- Controls -------------------- */
  q('#toggleLock').onclick = ()=>{
    locked = !locked;
    publish('state:lock', {locked});
    renderFac();
  };
  q('#seed').onclick = seedStatements;
  q('#seedPlan').onclick = seedPlan;

  /* -------------------- Channel listeners (vision) -------------------- */
  chan.onmessage = (e)=>{
    const {type, payload} = e.data || {};
    switch(type){
      case 'vision:add':
        statements.push(payload); renderFac(); break;
      case 'vision:seed':
        statements.push(...payload); renderFac(); break;
      case 'vote:add': {
        const st = statements.find(x=>x.id===payload.id);
        if(st){ st.votes = (st.votes||0)+1; const el = q('#votes_'+st.id); if(el) el.textContent = st.votes; }
        if(winnerId===null){ autoSuggestWinner(); }
        break;
      }
      case 'state:lock':
        locked = !!payload.locked; renderFac(); break;
      case 'vision:winner':
        winnerId = payload.id; renderFac(); break;
    }
  };

  function autoSuggestWinner(){
    if(!statements.length) return;
    const top = [...statements].sort((a,b)=> (b.votes||0)-(a.votes||0))[0];
    if(top && top.id !== winnerId){ winnerId = top.id; publish('vision:winner', {id:winnerId}); renderWinnerBox(); }
  }

  /* -------------------- Demo init -------------------- */
  function init(){
    // nav is single-screen for facilitator in this mock; nothing to toggle
    seedStatements();
    seedPlan();
    renderFac();
  }
  init();

  // util
  function cap(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : s; }
</script>
</body>
</html>

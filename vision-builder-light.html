<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Frontier — Final Output (Vision + Plan + Impact)</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --ink:#1f2937; --muted:#556581;
    --primary:#3b82f6; --accent:#10b981; --warn:#f59e0b; --violet:#8b5cf6;
    --border:#e5e7eb; --shadow:0 10px 24px rgba(31,41,55,.12); --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1100px 480px at 80% -10%, #e8f1ff 0%, #f5fbff 40%, var(--bg) 70%);
    font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }
  header{padding:18px 18px 8px; display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap}
  h1{margin:.2rem 0 .3rem; font-size:26px}
  .sub{color:var(--muted); max-width:980px}
  .nav{display:flex; gap:8px; flex-wrap:wrap}
  .tab{background:#fff; border:1px solid #d8dee8; color:#1f2937; padding:8px 12px; border-radius:10px; cursor:pointer}
  .tab.active{border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.18) inset}
  .wrap{padding:10px 18px 24px; display:grid; gap:16px}

  .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
  .panel header{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
  .panel main{padding:14px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .grid{display:grid; gap:12px}
  .cols-2{grid-template-columns:1fr 1fr}
  .cols-3{grid-template-columns:repeat(3,1fr)}
  .two{display:grid; grid-template-columns: 1.3fr .7fr; gap:16px}
  .small{font-size:12px; color:#6b7280}
  .hint{font-size:12px; color:#6b7280}
  .btn{background:#eff6ff; color:#0f3a8a; border:1px solid #cfe0ff; padding:10px 14px; border-radius:12px; cursor:pointer}
  .btn:hover{background:#e6f0ff}
  .btn-ghost{background:#fff; border:1px solid #d8dee8; color:#334155}
  .btn-small{padding:6px 10px; border-radius:10px; font-size:14px}

  /* Cards, pills */
  .card{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:10px 12px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .winner{background:#ecfeff; border:1px solid #bae6fd; color:#155e75; padding:12px 14px; border-radius:12px}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7e0ee; font-size:12px; background:#f8fafc; color:#334155}

  /* Plan lanes */
  .board{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
  .lane{background:#fff; border:2px dashed #d8dee8; border-radius:14px; min-height:200px; padding:10px}
  .lane h3{text-align:center; margin:0 0 8px; color:#1f3a8a}
  .icard{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:8px; margin:8px 0; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .kpi{font-size:13px; color:#334155}

  /* Chart + impacts */
  .chartbox{background:#fff; border:1px solid #e7ecf4; border-radius:14px; padding:10px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .legend{display:flex; gap:8px; flex-wrap:wrap; font-size:12px; color:#334155}
  .legend .dot{width:10px; height:10px; border-radius:999px; display:inline-block}
  .spot{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .tile{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:10px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
</style>
</head>
<body>

<header>
  <div>
    <h1>Final Output — Shared AI Vision • Frontier Action Plan • Impact</h1>
    <div class="sub">Once the facilitator selects a winner, this screen becomes the single **take-away**: winning vision, 12-month plan, balance chart, and impact call-outs.</div>
  </div>
  <nav class="nav" id="nav"></nav>
</header>

<section class="wrap">
  <!-- FACILITATOR (for continuity — optional quick seed/lock & winner) -->
  <div id="screen-fac" class="panel" style="display:none">
    <header>
      <strong>Facilitator — Live Statements</strong>
      <div class="row">
        <button class="btn-ghost btn-small" id="seedStatements">Seed statements</button>
        <button class="btn-ghost btn-small" id="selectTop">Select top as winner</button>
      </div>
    </header>
    <main>
      <div id="stmtList" class="grid"></div>
    </main>
  </div>

  <!-- FINAL OUTPUT -->
  <div id="screen-output" class="panel" style="display:none">
    <header>
      <strong>Workshop Output</strong>
      <div class="row">
        <label class="btn-ghost btn-small" style="cursor:pointer">Import FAP Plan JSON
          <input id="importPlan" type="file" accept=".json" style="display:none"/>
        </label>
        <button class="btn-ghost btn-small" id="seedPlan">Seed plan</button>
        <button class="btn-ghost btn-small" id="exportPack">Export Event Pack (JSON)</button>
        <button class="btn-ghost btn-small" id="exportMD">Export Markdown Summary</button>
      </div>
    </header>
    <main class="two">
      <!-- Left: Vision + Plan -->
      <div class="grid">
        <div class="winner" id="visionBox">
          <div class="small">Shared AI Vision (winner)</div>
          <div id="visionText" style="font-size:18px; font-weight:700; margin-top:6px">—</div>
          <div id="visionMeta" class="small" style="margin-top:6px">Team: — • Tone: —</div>
        </div>

        <div class="card">
          <div class="row" style="justify-content:space-between">
            <strong>12-Month Frontier Action Plan</strong>
            <span class="small">Sequenced initiatives with KPI targets</span>
          </div>
          <div id="board" class="board" style="margin-top:8px"></div>
        </div>
      </div>

      <!-- Right: Chart + Impact -->
      <div class="grid">
        <div class="chartbox">
          <strong>Portfolio Balance</strong>
          <canvas id="donut" width="360" height="240" aria-label="Portfolio balance"></canvas>
          <div class="legend" style="margin-top:6px">
            <span><span class="dot" style="background:#3b82f6"></span> 0–3</span>
            <span><span class="dot" style="background:#10b981"></span> 3–6</span>
            <span><span class="dot" style="background:#f59e0b"></span> 6–12</span>
          </div>
        </div>

        <div class="card">
          <div class="row" style="justify-content:space-between">
            <strong>Impact Spotlight</strong>
            <span class="small">Mock figures; customise for your client</span>
          </div>
          <div id="spot" class="spot" style="margin-top:8px"></div>
        </div>
      </div>
    </main>
  </div>
</section>

<script>
  /* -------------------- Real-time channel (winner comes from your Vision Builder) -------------------- */
  const chan = new BroadcastChannel('frontier-vision-ai-steering'); // keep same channel name used earlier
  const publish = (type, payload) => chan.postMessage({type, payload});

  /* -------------------- State -------------------- */
  // Winner from vision activity
  let winner = null; // {id, team, text, tone[], votes}
  // Plan (can be imported from FAP JSON, or demo-seeded here)
  let plan = { '0-3':[], '3-6':[], '6-12':[] };

  // Demo statements (for quick testing without the other file)
  let statements = [];

  /* -------------------- Simple nav -------------------- */
  const screens = [
    {id:'screen-fac', label:'Facilitator (demo)'},
    {id:'screen-output', label:'Final Output'}
  ];
  let current = 1; // default to Final Output
  const q = s => document.querySelector(s);
  function renderNav(){
    const nav = q('#nav'); nav.innerHTML='';
    screens.forEach((s,i)=>{
      const b = document.createElement('button');
      b.className = 'tab'+(i===current?' active':'');
      b.textContent = s.label;
      b.onclick = ()=> show(i);
      nav.appendChild(b);
    });
  }
  function show(i){
    current = i; renderNav();
    screens.forEach((s,idx)=> q('#'+s.id).style.display = (idx===i?'block':'none'));
    if(i===0) renderFacDemo();
    if(i===1) renderOutput();
  }

  /* -------------------- Winner handling -------------------- */
  function setWinner(w){
    winner = w;
    renderOutput();
  }

  /* -------------------- Plan rendering -------------------- */
  function renderPlan(){
    const board = q('#board'); board.innerHTML='';
    const lanes = [
      {key:'0-3', label:'0–3 months', note:'Quick wins / foundation'},
      {key:'3-6', label:'3–6 months', note:'Scale-ups'},
      {key:'6-12', label:'6–12 months', note:'Transformational'},
    ];
    lanes.forEach(L=>{
      const col = document.createElement('div');
      col.className='lane';
      col.innerHTML = `<h3>${L.label}</h3><div class="small">${L.note}</div>`;
      (plan[L.key]||[]).forEach(it=>{
        const card = document.createElement('div'); card.className='icard';
        card.innerHTML = `
          <div class="row" style="justify-content:space-between">
            <strong>${esc(it.title)}</strong>
            <span class="pill">${esc(cap(it.pillar||'initiative'))}</span>
          </div>
          <div class="kpi">KPI: <strong>${esc(it.kpi||'—')}</strong> &nbsp; Target: <strong>${esc(it.target||'—')}</strong></div>
        `;
        col.appendChild(card);
      });
      board.appendChild(col);
    });
  }

  /* -------------------- Donut chart -------------------- */
  function balanceCounts(){
    const c = {'0-3':0,'3-6':0,'6-12':0};
    ['0-3','3-6','6-12'].forEach(h=> c[h] = (plan[h]||[]).length);
    return c;
  }
  function renderDonut(){
    const canvas = q('#donut'); if(!canvas) return;
    const ctx = canvas.getContext('2d'), W=canvas.width, H=canvas.height;
    ctx.clearRect(0,0,W,H);
    const r = 90, cx=W/2, cy=H/2 - 5, inner=52;
    const colors = {'0-3':'#3b82f6','3-6':'#10b981','6-12':'#f59e0b'};
    const counts = balanceCounts();
    const total = Math.max(1, counts['0-3']+counts['3-6']+counts['6-12']);
    let start = -Math.PI/2;
    ['0-3','3-6','6-12'].forEach(h=>{
      const frac = counts[h]/total;
      const end = start + frac*2*Math.PI;
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,start,end); ctx.closePath();
      ctx.fillStyle = colors[h]; ctx.globalAlpha = 0.85; ctx.fill();
      start = end;
    });
    ctx.globalAlpha = 1; ctx.fillStyle = '#ffffff'; ctx.beginPath(); ctx.arc(cx,cy,inner,0,2*Math.PI); ctx.fill();
    ctx.fillStyle = '#475569'; ctx.font = '12px system-ui, -apple-system, Segoe UI'; ctx.textAlign='center';
    ctx.fillText('Portfolio balance', cx, cy-2);
    ctx.font = 'bold 14px system-ui, -apple-system, Segoe UI';
    ctx.fillText(`${total} initiatives`, cx, cy+16);
  }

  /* -------------------- Impact Spotlight -------------------- */
  function renderImpact(){
    const spot = q('#spot'); spot.innerHTML='';
    // You can compute these from your real plan; here we mock sensible defaults
    const roll = {
      rev: '£1.8M–£2.4M (12m)',
      prod: '~2 hrs/FTE/wk',
      cx: '−20–25% inbound',
      risk: '−30–40% findings',
      innov: '12 prototypes/yr',
      cycle: '< 48h avg cycle'
    };
    const tiles = [
      {label:'Projected revenue uplift', val: roll.rev, sub:'Sales & CX initiatives'},
      {label:'Productivity hours saved', val: roll.prod, sub:'Copilot & automation'},
      {label:'Customer experience', val: roll.cx, sub:'Proactive service, AOV'},
      {label:'Risk posture', val: roll.risk, sub:'Compliance monitors'},
      {label:'Innovation throughput', val: roll.innov, sub:'AI Product Studio'},
      {label:'Cycle time', val: roll.cycle, sub:'Workflow orchestrator'},
    ];
    tiles.forEach(t=>{
      const d = document.createElement('div'); d.className='tile';
      d.innerHTML = `<div class="small">${t.label}</div>
        <div style="font-size:22px;font-weight:700;margin:2px 0 4px">${esc(t.val)}</div>
        <div class="kpi">${esc(t.sub)}</div>`;
      spot.appendChild(d);
    });
  }

  /* -------------------- Output rendering -------------------- */
  function renderOutput(){
    // Vision box
    const vText = q('#visionText'), vMeta = q('#visionMeta');
    if(winner){
      vText.textContent = winner.text;
      vMeta.textContent = `Team: ${winner.team} • Tone: ${(winner.tone||[]).join(', ') || '—'}`;
    } else {
      vText.textContent = 'Awaiting winner from facilitator…';
      vMeta.textContent = 'Team: — • Tone: —';
    }
    // Plan + Chart + Impact
    renderPlan();
    renderDonut();
    renderImpact();
  }

  /* -------------------- Imports/Exports -------------------- */
  q('#importPlan').addEventListener('change', e=>{
    const f = e.target.files[0]; if(!f) return;
    const fr = new FileReader();
    fr.onload = ()=>{
      try{
        const data = JSON.parse(fr.result);
        if(data.plan){ plan = data.plan; }
        else if(data['0-3']||data['3-6']||data['6-12']) { plan = data; }
        else { alert('JSON must contain {plan:{0-3,3-6,6-12}} or top-level lanes.'); return; }
        renderOutput();
      }catch{ alert('Could not parse plan JSON'); }
    };
    fr.readAsText(f);
  });

  q('#exportPack').onclick = ()=>{
    const payload = { generatedAt:new Date().toISOString(), winner, plan };
    download('frontier-final-output.json', JSON.stringify(payload,null,2), 'application/json');
  };
  q('#exportMD').onclick = ()=>{
    const md = `# Workshop Final Output

## Shared AI Vision
${winner ? `> ${winner.text}\n\n_Team:_ ${winner.team}  \n_Tone:_ ${(winner.tone||[]).join(', ') || '—'}` : '> (Winner not set yet)'}

---

## Frontier Action Plan (12 months)

### 0–3 months
${(plan['0-3']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}`).join('\n') || '—'}

### 3–6 months
${(plan['3-6']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}`).join('\n') || '—'}

### 6–12 months
${(plan['6-12']||[]).map(i=>`- **${i.title}** — KPI: ${i.kpi} → ${i.target}`).join('\n') || '—'}

---

## Impact Spotlight (mock)
- Revenue uplift: £1.8M–£2.4M (12m)
- Productivity: ~2 hrs/FTE/wk
- CX: −20–25% inbound
- Risk: −30–40% findings
- Innovation: 12 prototypes/yr
- Cycle time: < 48h
`;
    download('frontier-final-output.md', md, 'text/markdown');
  };
  function download(filename, text, type){
    const blob = new Blob([text], {type:type||'text/plain;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href);
  }

  /* -------------------- Facilitator demo (optional) -------------------- */
  function renderFacDemo(){
    const wrap = q('#stmtList'); wrap.innerHTML='';
    if(!statements.length){
      wrap.innerHTML = '<div class="card small">No statements yet — click “Seed statements”.</div>';
      return;
    }
    statements.forEach(s=>{
      const d = document.createElement('div'); d.className='card';
      d.innerHTML = `<div class="row" style="justify-content:space-between">
        <strong>${esc(s.team)}</strong><span class="small">${s.votes||0} votes</span></div>
        <div style="margin-top:6px">${esc(s.text)}</div>`;
      wrap.appendChild(d);
    });
  }
  q('#seedStatements')?.addEventListener('click', ()=>{
    statements = [
      {id:uid(), team:'Team Nova', text:'We are an AI-empowered organization where every employee is augmented by Copilot, customer needs are anticipated, and decisions move at the speed of data — innovation as a monthly habit with trust by design.', tone:['Ambitious','People-first'], votes:4},
      {id:uid(), team:'Team Atlas', text:'In 12 months we are a trusted, data-driven enterprise: employees focus on high-value work, engagement is proactive, and intelligent operations shrink cycle time from weeks to days.', tone:['Practical','Operational'], votes:2}
    ];
    renderFacDemo();
  });
  q('#selectTop')?.addEventListener('click', ()=>{
    if(!statements.length) return alert('Seed or receive statements first.');
    const top = [...statements].sort((a,b)=> (b.votes||0)-(a.votes||0))[0];
    // simulate facilitator selection
    publish('vision:winner', {id: top.id});
    setWinner(top);
    show(1);
  });

  /* -------------------- Seed plan for demo -------------------- */
  q('#seedPlan').addEventListener('click', ()=>{
    plan = {
      '0-3':[
        mkPlan('Employee Copilot pilot (HR & Sales)','employee','Hrs saved / FTE','2 hrs/wk'),
        mkPlan('AI meeting recaps + next-step assistant','employee','Adoption','>70%'),
        mkPlan('Knowledge hub answers in 30s','employee','Time to answer','<30s')
      ],
      '3-6':[
        mkPlan('AI Sales Companion (next-best-offer)','customer','Win rate','+10%'),
        mkPlan('Proactive service (resolve before call)','customer','Inbound volume','-25%'),
        mkPlan('Workflow orchestrator (CRM↔ERP)','process','Cycle time','< 48h')
      ],
      '6-12':[
        mkPlan('AI Product Studio (monthly demos)','innovation','Prototypes/yr','12'),
        mkPlan('Data monetization pilot','innovation','Data ARR','$600k'),
        mkPlan('Intelligent ops dashboard','process','Observability','Org-wide')
      ]
    };
    renderOutput();
  });
  function mkPlan(title,pillar,kpi,target){ return {title,pillar,kpi,target}; }

  /* -------------------- Channel listeners (listen for real winner from Vision Builder) -------------------- */
  chan.onmessage = (e)=>{
    const {type, payload} = e.data || {};
    if(type==='vision:winner'){
      // In the vision builder, other tabs also broadcast the actual statement elsewhere;
      // here we only know the id — but often you also broadcast the statement.
      // For robustness, if we’ve also received the statements list in this tab, use it; otherwise keep waiting.
      const found = statements.find(x=>x.id===payload.id);
      if(found){ setWinner(found); }
    }
    if(type==='vision:seed'){
      // capture statements for this tab (so winner id can be resolved)
      statements.push(...payload);
      renderFacDemo();
    }
    if(type==='vision:add'){
      statements.push(payload);
      renderFacDemo();
    }
  };

  /* -------------------- Utils -------------------- */
  const esc = s => String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const cap = s => s ? s.charAt(0).toUpperCase()+s.slice(1) : s;

  /* -------------------- Init -------------------- */
  function init(){
    renderNav();
    show(current);
    // seed plan so the Output looks populated immediately
    document.getElementById('seedPlan').click();
    // seed demo statements so "Facilitator (demo)" works offline
    document.getElementById('seedStatements')?.click();
    // select top as winner to showcase the output in one click
    document.getElementById('selectTop')?.click();
  }
  init();
</script>
</body>
</html>

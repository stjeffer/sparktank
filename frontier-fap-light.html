<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Frontier — FAP Sequencing (Light)</title>
<style>
  :root{
    --bg:#f7fafc; --card:#ffffff; --ink:#1f2937; --muted:#556581;
    --primary:#3b82f6; --primary-600:#2563eb; --accent:#10b981; --warn:#f59e0b; --danger:#ef4444;
    --border:#e5e7eb; --shadow:0 10px 24px rgba(31,41,55,.12); --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1100px 480px at 80% -10%, #e8f1ff 0%, #f5fbff 40%, var(--bg) 70%);
    font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  header{padding:18px 18px 8px; display:flex; gap:16px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap}
  h1{margin:.2rem 0 .3rem; font-size:26px}
  .sub{color:var(--muted); max-width:960px}
  .nav{display:flex; gap:8px; flex-wrap:wrap}
  .tab{background:#fff; border:1px solid #d8dee8; color:#1f2937; padding:8px 12px; border-radius:10px; cursor:pointer}
  .tab.active{border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.18) inset}
  .wrap{padding:10px 18px 24px; display:grid; gap:16px}
  .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
  .panel header{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between}
  .panel main{padding:14px}

  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .btn{background:#eff6ff; color:#0f3a8a; border:1px solid #cfe0ff; padding:10px 14px; border-radius:12px; cursor:pointer}
  .btn:hover{background:#e6f0ff}
  .btn-primary{background:linear-gradient(180deg,#60a5fa,#3b82f6); color:#fff; border:1px solid #3b82f6}
  .btn-ghost{background:#fff; border:1px solid #d8dee8; color:#334155}
  .btn-warn{background:#fff7ed; color:#9a3412; border:1px solid #fed7aa}
  .btn-small{padding:6px 10px; border-radius:10px; font-size:14px}

  input, select{background:#fff; border:1px solid #d8dee8; color:#1f2937; border-radius:12px; padding:10px 12px}
  input:focus, select:focus{outline:none; border-color:#c4d5ff; box-shadow:0 0 0 3px rgba(59,130,246,.15)}
  label{display:block; font-size:13px; color:#42506b; margin:8px 0 6px}

  .hint{font-size:12px; color:#6b7280}
  .status{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #e2e8f0}
  .s-open{background:#f0f9ff; color:#075985; border-color:#bae6fd}
  .s-locked{background:#fff7ed; color:#9a3412; border-color:#fed7aa}
  .timer{font-variant-numeric:tabular-nums; font-weight:700; font-size:26px; letter-spacing:.5px}

  /* Team board */
  .columns{display:grid; grid-template-columns: 340px 1fr; gap:16px}
  .stack{background:#fff; border:1px dashed #d8dee8; border-radius:14px; padding:10px; min-height:120px}
  .cards{display:grid; gap:10px}
  .card{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:10px; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .i-meta{color:#556581; font-size:13px}
  .drag{cursor:grab}
  .board{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
  .lane{background:#fff; border:2px dashed #d8dee8; border-radius:14px; min-height:220px; padding:10px}
  .lane.drop{background:#f0f9ff; border-color:#93c5fd}
  .lane h3{text-align:center; margin:0 0 8px; color:#1f3a8a}
  .badge{background:#ecfeff; color:#155e75; border:1px solid #bae6fd; padding:2px 8px; border-radius:999px; font-size:12px}
  .pill{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7e0ee; font-size:12px; background:#f8fafc; color:#334155}
  .icard{background:#fff; border:1px solid #e7ecf4; border-radius:12px; padding:8px; margin:8px 0; box-shadow:0 6px 14px rgba(15,23,42,.06)}
  .muted{color:#6b7280; font-size:13px}
  .empty{padding:12px; border:2px dashed #d8dee8; border-radius:10px; color:#6b7280; background:#fbfdff}

  /* Facilitator grid */
  .gridboard{overflow:auto}
  .hdr{display:grid; grid-template-columns: 200px repeat(3, 1fr); gap:1px; padding:8px 10px; border-bottom:1px solid var(--border)}
  .col-h{border:1px solid #d8dee8; border-radius:10px; text-align:center; padding:6px; font-weight:700}
  .table{display:grid; grid-template-columns: 200px repeat(3, 1fr); gap:1px}
  .rowlab{padding:10px; border-right:1px solid #e5e7eb; font-weight:600}
  .cell{min-height:130px; border-left:1px solid #e5e7eb; border-bottom:1px solid #e5e7eb; padding:8px; display:flex; gap:8px; flex-wrap:wrap; align-content:flex-start}
</style>
</head>
<body>

<header>
  <div>
    <h1>Frontier Action Plan — Sequencing</h1>
    <div class="sub">Drag the top initiatives into the <strong>0–3, 3–6, 6–12 month</strong> lanes. The facilitator sees all teams in real time. A <strong>20-minute timer</strong> runs the activity; boards lock at time-up.</div>
  </div>
  <nav class="nav" id="nav"></nav>
</header>

<section class="wrap">
  <!-- TEAM SCREEN -->
  <div id="screen-team" class="panel" style="display:none">
    <header>
      <strong>Team Board</strong>
      <div class="row">
        <div class="status" id="lockStateTeam">OPEN</div>
        <span class="hint">This tab is for teams. Pick your team name, then drag initiatives into lanes.</span>
      </div>
    </header>
    <main>
      <div class="row">
        <div>
          <label for="teamName">Team name *</label>
          <input id="teamName" placeholder="Team Nova"/>
        </div>
        <div>
          <label for="teamColor">Color</label>
          <input id="teamColor" type="color" value="#60a5fa"/>
        </div>
        <button class="btn btn-ghost" id="saveTeam">Save</button>
        <span class="hint">Saved locally for this browser.</span>
      </div>

      <div class="columns" style="margin-top:10px">
        <!-- backlog -->
        <div>
          <div class="card">
            <div class="row" style="justify-content:space-between">
              <strong>Top initiatives (drag to timeline)</strong>
              <button class="btn btn-ghost btn-small" id="seedTop">Seed examples</button>
            </div>
            <div id="backlog" class="stack"></div>
            <div class="hint" style="margin-top:8px">Tip: Prioritize by revenue impact first.</div>
          </div>
        </div>
        <!-- lanes -->
        <div>
          <div class="board">
            <div class="lane" data-h="0-3">
              <h3>0–3 months</h3>
              <div class="muted">Quick wins / foundation</div>
              <div class="lane-body" id="lane-0-3"></div>
            </div>
            <div class="lane" data-h="3-6">
              <h3>3–6 months</h3>
              <div class="muted">Scale-ups</div>
              <div class="lane-body" id="lane-3-6"></div>
            </div>
            <div class="lane" data-h="6-12">
              <h3>6–12 months</h3>
              <div class="muted">Transformational</div>
              <div class="lane-body" id="lane-6-12"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- FACILITATOR SCREEN -->
  <div id="screen-fac" class="panel" style="display:none">
    <header>
      <strong>Facilitator — Live Sequencing</strong>
      <div class="row">
        <div id="lockStateFac" class="status s-open">OPEN</div>
        <span class="timer" id="timer">20:00</span>
        <button class="btn btn-ghost btn-small" id="startTimer">Start</button>
        <button class="btn btn-ghost btn-small" id="pauseTimer">Pause</button>
        <button class="btn btn-ghost btn-small" id="resetTimer">Reset</button>
        <button class="btn btn-warn btn-small" id="lockNow">Lock now</button>
        <button class="btn btn-ghost btn-small" id="exportJSON">Export plan (JSON)</button>
      </div>
    </header>
    <main>
      <div class="gridboard">
        <div class="hdr">
          <div></div>
          <div class="col-h">0–3 months</div>
          <div class="col-h">3–6 months</div>
          <div class="col-h">6–12 months</div>
        </div>
        <div id="grid" class="table"></div>
      </div>
      <div class="hint" style="margin-top:10px">Tip: Keep this on the big screen. Teams work on their boards; you’ll see updates live.</div>
    </main>
  </div>
</section>

<script>
  /* ---------- Real-time channel ---------- */
  const chan = new BroadcastChannel('frontier-fap');
  function publish(type, payload){ chan.postMessage({type, payload}); }

  /* ---------- State ---------- */
  let locked = false;
  let team = { name: localStorage.getItem('fap.team') || '', color: localStorage.getItem('fap.color') || '#60a5fa' };
  let backlog = []; // {id,title,pillar,kpi,target}
  let placed = { '0-3':[], '3-6':[], '6-12':[] }; // team local placements

  // facilitator state: map teamName -> {color, lanes:{...}}
  let facState = {}; // { [teamName]: { color, lanes: {'0-3':[], '3-6':[], '6-12':[]} } }

  /* ---------- UI helpers ---------- */
  const q = sel => document.querySelector(sel);
  const qa = sel => Array.from(document.querySelectorAll(sel));
  const uid = () => Math.random().toString(36).slice(2,10);
  const esc = s => String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  /* ---------- Router ---------- */
  const screens = [
    {id:'screen-team', label:'Team'},
    {id:'screen-fac', label:'Facilitator'}
  ];
  let current = 0;
  function renderNav(){
    const nav = q('#nav'); nav.innerHTML='';
    screens.forEach((s,i)=>{
      const b = document.createElement('button');
      b.className = 'tab'+(i===current?' active':'');
      b.textContent = s.label;
      b.addEventListener('click', ()=> show(i));
      nav.appendChild(b);
    });
  }
  function show(i){
    current = i; renderNav();
    screens.forEach((s,idx)=> q('#'+s.id).style.display = idx===i?'block':'none');
    if(i===0) renderTeam();
    if(i===1) renderFac();
  }

  /* ---------- Seed top 10 initiatives ---------- */
  function seedTopData(){
    const items = [
      mkTop('Employee Copilot pilot (HR & Sales)','employee','Hrs saved / FTE','2 hrs/wk'),
      mkTop('AI meeting recaps + next-step assistant','employee','Adoption','>70%'),
      mkTop('AI Sales Companion (next-best-offer)','customer','Win rate','+10%'),
      mkTop('Proactive service (resolve before call)','customer','Inbound volume','-25%'),
      mkTop('Workflow orchestrator (CRM↔ERP)','process','Cycle time','< 48h'),
      mkTop('Self-serve analytics w/ Copilot','employee','DIY reports','70%'),
      mkTop('Compliance monitor agent','process','Audit findings','-40%'),
      mkTop('AI Product Studio (monthly demos)','innovation','Prototypes/yr','12'),
      mkTop('Data monetization pilot','innovation','Data ARR','$600k'),
      mkTop('Customer personalization engine','customer','AOV','+7%'),
    ];
    backlog = items;
    renderTeam();
  }
  function mkTop(title,pillar,kpi,target){ return { id:uid(), title, pillar, kpi, target }; }

  /* ---------- TEAM SCREEN ---------- */
  function renderTeam(){
    // header status
    q('#lockStateTeam').textContent = locked ? 'LOCKED' : 'OPEN';
    q('#lockStateTeam').className = 'status ' + (locked?'s-locked':'s-open');

    // team fields
    q('#teamName').value = team.name || '';
    q('#teamColor').value = team.color || '#60a5fa';

    // enable/disable on lock
    qa('#screen-team input, #screen-team button').forEach(el=>{
      if(el.id==='seedTop' || el.id==='saveTeam') return;
      el.disabled = locked;
    });

    // backlog cards (draggable)
    const bl = q('#backlog'); bl.innerHTML='';
    if(backlog.length===0) {
      bl.innerHTML = `<div class="empty">No items yet — click “Seed examples” to load the top 10.</div>`;
    } else {
      backlog.forEach(item => bl.appendChild(renderBacklogCard(item)));
    }

    // lanes
    ['0-3','3-6','6-12'].forEach(h=>{
      const laneBody = q('#lane-'+h.replace('-','-'));
      laneBody.innerHTML='';
      if(placed[h].length===0){
        const d = document.createElement('div');
        d.className='muted'; d.textContent='Drop initiatives here';
        laneBody.appendChild(d);
      } else {
        placed[h].forEach(item => laneBody.appendChild(renderPlacedCard(item, h)));
      }
    });

    // dnd handlers
    qa('.lane').forEach(l=>{
      l.addEventListener('dragover', e=>{ if(locked) return; e.preventDefault(); l.classList.add('drop'); });
      l.addEventListener('dragleave', ()=> l.classList.remove('drop'));
      l.addEventListener('drop', e=>{
        if(locked) return;
        e.preventDefault(); l.classList.remove('drop');
        const id = e.dataTransfer.getData('text/plain');
        const h = l.dataset.h;
        moveItemToLane(id, h);
      });
    });
  }

  function renderBacklogCard(item){
    const c = document.createElement('div');
    c.className = 'card drag'; c.draggable = !locked; c.id = 'bl_'+item.id;
    c.addEventListener('dragstart', e=> e.dataTransfer.setData('text/plain', item.id));
    c.innerHTML = `
      <div><strong>${esc(item.title)}</strong></div>
      <div class="i-meta">Pillar: <span class="pill">${esc(cap(item.pillar))}</span></div>
      <div class="i-meta">KPI: <strong>${esc(item.kpi)}</strong> → <strong>${esc(item.target)}</strong></div>
    `;
    return c;
  }

  function renderPlacedCard(item, h){
    const c = document.createElement('div');
    c.className = 'icard drag'; c.draggable = !locked; c.id = 'pl_'+item.id;
    c.addEventListener('dragstart', e=> e.dataTransfer.setData('text/plain', item.id));
    c.innerHTML = `
      <div class="row" style="justify-content:space-between">
        <div><strong>${esc(item.title)}</strong></div>
        <span class="badge">${h}</span>
      </div>
      <div class="i-meta">KPI: <strong>${esc(item.kpi)}</strong> → <strong>${esc(item.target)}</strong></div>
    `;
    return c;
  }

  function moveItemToLane(id, horizon){
    // from backlog?
    const idx = backlog.findIndex(x=>x.id===id);
    let item;
    if(idx>-1){ item = backlog.splice(idx,1)[0]; }
    else {
      // from other lane
      for(const h of ['0-3','3-6','6-12']){
        const j = placed[h].findIndex(x=>x.id===id);
        if(j>-1){ item = placed[h].splice(j,1)[0]; break; }
      }
    }
    if(!item) return;
    placed[horizon].push(item);
    renderTeam();
    // notify facilitator
    if(team.name){
      publish('place', { team: team.name, color: team.color, horizon, item });
      // keep a local projection of facilitator state too
      upsertFac(team.name, team.color, horizon, item);
    }
  }

  q('#seedTop').addEventListener('click', seedTopData);
  q('#saveTeam').addEventListener('click', ()=>{
    const name = q('#teamName').value.trim();
    const color = q('#teamColor').value;
    if(!name){ alert('Enter a team name'); return; }
    team = { name, color };
    localStorage.setItem('fap.team', name);
    localStorage.setItem('fap.color', color);
    // announce presence + push current placements (if any)
    publish('hello', { team:name, color });
    // also push existing placed items (on refresh)
    ['0-3','3-6','6-12'].forEach(h=> placed[h].forEach(item => publish('place', {team:name, color, horizon:h, item})));
  });

  /* ---------- FACILITATOR SCREEN ---------- */
  function upsertFac(teamName, color, horizon, item){
    if(!facState[teamName]) facState[teamName] = { color, lanes: {'0-3':[], '3-6':[], '6-12':[]} };
    // remove if already placed elsewhere
    ['0-3','3-6','6-12'].forEach(h=>{
      facState[teamName].lanes[h] = facState[teamName].lanes[h].filter(x=>x.id!==item.id);
    });
    facState[teamName].lanes[horizon].push(item);
  }

  function renderFac(){
    const st = q('#lockStateFac');
    st.textContent = locked ? 'LOCKED' : 'OPEN';
    st.className = 'status ' + (locked ? 's-locked' : 's-open');

    const grid = q('#grid'); grid.innerHTML='';
    const teams = Object.keys(facState).sort((a,b)=> a.localeCompare(b));
    if(!teams.length){
      // show empty rows for a few example teams
      ['Team Nova','Team Atlas','Team Quasar'].forEach(name=>{
        if(!facState[name]) facState[name]={color:'#60a5fa',lanes:{'0-3':[],'3-6':[],'6-12':[]}};
      });
    }
    const names = Object.keys(facState);
    names.forEach(name=>{
      const lab = document.createElement('div');
      lab.className = 'rowlab';
      lab.innerHTML = `<strong>${esc(name)}</strong>`;
      grid.appendChild(lab);
      ['0-3','3-6','6-12'].forEach(h=>{
        const cell = document.createElement('div'); cell.className='cell';
        const items = (facState[name].lanes[h]||[]);
        if(!items.length){
          cell.innerHTML = `<div class="muted">—</div>`;
        }else{
          items.forEach(it=>{
            const d = document.createElement('div');
            d.className = 'icard';
            d.innerHTML = `<div><strong>${esc(it.title)}</strong></div>
                           <div class="muted">KPI <strong>${esc(it.kpi)}</strong> → <strong>${esc(it.target)}</strong></div>`;
            cell.appendChild(d);
          });
        }
        grid.appendChild(cell);
      });
    });
  }

  // Export (facilitator)
  q('#exportJSON').addEventListener('click', ()=>{
    const payload = {
      generatedAt: new Date().toISOString(),
      locked,
      teams: Object.entries(facState).map(([name, val])=>({
        team: name,
        color: val.color,
        lanes: val.lanes
      }))
    };
    const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='frontier-fap-plan.json'; a.click(); URL.revokeObjectURL(a.href);
  });

  /* ---------- Timer (20:00) ---------- */
  let remaining = 20*60; // seconds
  let handle = null;
  function fmt(sec){ const m = Math.floor(sec/60), s = sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
  function tick(){
    if(remaining<=0){ clearInterval(handle); handle=null; q('#timer').textContent='00:00'; lockAll(false); return; }
    remaining--; q('#timer').textContent = fmt(remaining);
  }
  q('#startTimer').addEventListener('click', ()=>{ if(locked || handle) return; handle = setInterval(tick,1000); });
  q('#pauseTimer').addEventListener('click', ()=>{ if(handle){ clearInterval(handle); handle=null; }});
  q('#resetTimer').addEventListener('click', ()=>{ if(handle){ clearInterval(handle); handle=null; } remaining=20*60; q('#timer').textContent=fmt(remaining); });
  q('#lockNow').addEventListener('click', ()=> lockAll(true));
  function lockAll(manual){
    if(locked) return;
    locked = true;
    publish('lock', {at:new Date().toISOString(), manual});
    renderTeam(); renderFac();
  }

  /* ---------- Channel listeners ---------- */
  chan.onmessage = (e)=>{
    const {type, payload} = e.data || {};
    switch(type){
      case 'hello':
        facState[payload.team] = facState[payload.team] || { color: payload.color, lanes: {'0-3':[],'3-6':[],'6-12':[]} };
        renderFac();
        break;
      case 'place':
        upsertFac(payload.team, payload.color, payload.horizon, payload.item);
        renderFac();
        break;
      case 'lock':
        locked = true; renderTeam(); renderFac();
        break;
    }
  };

  /* ---------- Init ---------- */
  function init(){
    renderNav(); show(0); // default Team
    // seed top initiatives so teams can start
    seedTopData();
    // announce team if already saved
    if(team.name){ publish('hello', team); }
    // init facilitator timer display
    q('#timer').textContent = fmt(remaining);
  }
  init();

  // utility
  function cap(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : s; }
</script>
</body>
</html>
